{% extends 'crm/base.html' %}
{% load static %}
{% block title %}
  Your Personalized Messages
{% endblock title %}
{% block extra_css %}
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
{% endblock extra_css %}
{% block body_no_container %}
  <div id="personalized">
    <div class="uk-container uk-margin-medium-top" id="">
      <section data-uk-grid class="uk-child-width-1-2@m">
        <div>
          <div class="srm-page-heading">
            Your Personalized Messages
          </div>
        </div>
        <div>
          <button class="srm-button srm-button-primary-outline srm-float-right@m" @click.prevent="openCreateMessageModal">Create</button>
        </div>
      </section>
      <div class="uk-child-width-1-3@m uk-child-width-1-2@s srm-contacts-card-list uk-margin-small-top" data-uk-grid v-cloak>
        <div v-for="(message, key) in messages.results" :key="key" class="uk-margin-medium-bottom">
          <div class="srm-card uk-padding-remove srm-contact-card">
            <table class="srm-contact-card-table">
              <tbody>
              <tr>
                <td>
                  <div class="uk-width-1-1 uk-margin-remove" data-uk-grid>
                    <div class="srm-contact-card-value-small"> Added: [[ message.created ]]</div>
                  </div>
                </td>
              </tr>
              <tr>
                <td class="uk-padding-remove-top uk-padding-remove-bottom">
                  <div class="uk-width-1-1 uk-flex uk-flex-center uk-padding-small">
                    <h4 class="uk-text-bold uk-margin-remove crm-large-text break-word">[[ message.name ]]</h4>
                    <span class="uk-badge uk-margin-small-left">[[ message.type ]]</span>
                  </div>
                </td>
              </tr>
              <tr>
                <td v-if="!message.audio_processed && message.type === 'voice' && message.audio">
                  <div class="uk-text-center">
                    Audio is processing
                  </div>
                </td>
                <td v-else>
                  <audio style="height: 55px;" controls v-if="message.audio">
                    <source :src="message.audio" preload="auto" type="audio/mpeg">
                    Browser cannot play audio
                  </audio>
                  <div class="uk-text-center" v-else>[[ message.text ]]</div>
                </td>
              </tr>
              <tr>
                <td>
                  <div class="uk-width-1-1 uk-flex uk-flex-center">
                    <button class="srm-button srm-button-primary-outline" @click.prevent="deleteMessage(key, message.id)">Delete</button>
                  </div>
                </td>
              </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="uk-alert uk-alert-primary uk-width-1-1" v-if="messages.results.length < 1">
        You have no personalized messages, please click on create to add
      </div>

      {% include 'crm/marketing/autodialer/includes/create-personalized-modal.html' %}

      <div class="srm-table-footer uk-width-auto@m uk-flex uk-flex-right" v-cloak>
        <button @click.prevent="previous" :disabled="!messages.previous" class="srm-button-transparent"><span class="uk-margin-small-right" uk-pagination-previous></span> Previous</button>
        <span>[[ messages.count > 0 ? (page * 100) + 1 : 0 ]] - [[ messages.results.length + (page * 100) ]] of [[ messages.count ]]</span>
        <button :disabled="!messages.next" @click.prevent="next" class="srm-button-transparent">Next <span class="uk-margin-small-left" uk-pagination-next></span></button>
      </div>

    </div>
  </div>
{% endblock body_no_container %}
{% block extra_js %}
  <script src="{% static 'crm/js/marketing/campaigns/personalized-messages.js' %}"></script>
{% endblock extra_js %}
