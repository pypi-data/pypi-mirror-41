{% extends 'crm/base.html' %}
{% load static %}
{% block title %}
Billings
{% endblock title %}

{% block body %}
<div class="uk-container">
    <div class="uk-width-1-1 srm-contacts-card-list grid-padding crm-grid-padding uk-grid-match" data-uk-grid>
        <div class="uk-width-1-3@m">
            <div class="srm-card uk-padding-remove srm-contact-card billings-card">
                <div class="srm-page-heading srm-card-header-outside">
                    <header class="billings-header">Billing details</header>
                </div>
                <table class="srm-contact-card-table border-table">
                    <tbody>
                    <form action="{% url 'srm:billings:change_billing_info_view' %}" method="post"> {% csrf_token %}
                        <tr>
                            <td class="uk-padding-small uk-padding-remove-bottom">
                               <div class="">
                                    <label class="uk-form-label billings-label">Name{{ billing_name }}</label>
                                    <div class="uk-form-controls">
                                        <input class="srm-input billings-input" type="text" name="billing_name" value="{{ billing_name|default:'' }}">
                                    </div>
                                 </div>
                            </td>
                        </tr>
                        <tr>
                            <td class="uk-padding-small uk-padding-remove-bottom">
                               <div class="">
                                    <label class="uk-form-label billings-label">Address line 1</label>
                                    <div class="uk-form-controls">
                                        <input class="srm-input billings-input" type="text" name="address_line1" value="{{ billing_address_line1|default:'' }}">
                                    </div>
                                 </div>
                            </td>
                        </tr>
                        <tr>
                            <td class="uk-padding-small uk-padding-remove-bottom">
                               <div class="">
                                    <label class="uk-form-label billings-label">Address line 2</label>
                                    <div class="uk-form-controls">
                                        <input class="srm-input billings-input" type="text" name="address_line2" value="{{ billing_address_line2|default:'' }}">
                                    </div>
                                 </div>
                            </td>
                        </tr>
                        <tr>
                            <td class="uk-padding-small uk-padding-remove-bottom">
                               <div class="">
                                    <label class="uk-form-label billings-label">City</label>
                                    <div class="uk-form-controls">
                                        <input class="srm-input billings-input"  name="address_city" type="text" value="{{ billing_address_city|default:'' }}">
                                    </div>
                                 </div>
                            </td>
                        </tr>
                        <tr>
                            <td class="uk-padding-small uk-padding-remove-bottom">
                               <div class="uk-child-width-1-2@m" data-uk-grid>
                                   <div>
                                        <label class="uk-form-label billings-label">State</label>
                                        <div class="uk-form-controls">
                                            <input class="srm-input billings-input" type="text" name="address_state" value="{{ billing_address_state|default:'' }}">
                                        </div>
                                   </div>
                                   <div>
                                        <label class="uk-form-label billings-label">Zip code</label>
                                        <div class="uk-form-controls">
                                            <input class="srm-input billings-input" type="text" name="address_zip" value="{{ billing_address_zip|default:'' }}">
                                        </div>
                                   </div>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td class="uk-padding-small uk-padding-remove-bottom">
                               <div class="">
                                    <label class="uk-form-label billings-label">Country</label>
                                    <div class="uk-form-controls">
                                        <input class="srm-input billings-input" id="" type="text" name="address_country" value="{{ billing_address_country|default:'' }}">
                                    </div>
                                 </div>
                            </td>
                        </tr>
                        <tr>
                            <td class="uk-padding-small">
                                <div class="uk-width-1-1 uk-flex uk-flex-center uk-padding">
                                  <div><button class="srm-button srm-button-primary-outline billings-button uk-margin-left">
                                    {% if card_last4 and card_type %}
                                    Save changes
                                    {% else %}
                                    <a href="{% url 'srm:packages:select_plan' %}" class="icon-colour">Purchase Plan</a>{% endif %}</button></div>
                               </div>
                            </td>
                        </tr>
                    </form>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="uk-width-1-3@m">
            <div class="srm-card uk-padding-remove srm-contact-card uk-overflow-hidden">
                <div class="srm-page-heading srm-card-header-outside">
                   <header class="billings-header">Current plan</header>
                </div>
                <table class="srm-contact-card-table">
                    <tbody>
                    <form>
                        <tr class="Rectangle-3">
                            <td class="uk-padding-remove-top uk-padding-remove-bottom">
                                {% if package %}
                                <div class="uk-flex uk-flex-center uk-padding">
                                   <div><span class="Recharge-SMS">Current Plan: {{ package.type.title }}</span></div>
                                </div>
                                {% if package.type.package_type_after_trial %}
                                    Will be switched to <strong>{{ package.type.package_type_after_trial }}</strong> automatically on {{ customer.trial_end }}
                                {% else %}
                               <div class="uk-flex uk-flex-center uk-padding-small">
                                   <div><span class="layer">${{ package.type.cost}}</span></div>
                                </div>
                               <div class="uk-flex uk-flex-center uk-padding">
                                   <div><span class="Plan-renews-monthly">Plan renews monthly</span></div>
                                </div>
                                {% endif %}
                                {% else %}
                                <div class="uk-flex uk-flex-center uk-padding">
                                   <div><span class="Recharge-SMS">No active plans.</span></div>
                                </div>
                                <div class="uk-flex uk-flex-center uk-padding">
                                   <div><a class="Plan-renews-monthly" href="{% url 'srm:packages:select_plan' %}">Purchase a plan now</a></div>
                                </div>

                                {% endif  %}
                            </td>
                        </tr>
                        <tr>
                            <td class="fixed-padding5">
                                <div class="uk-width-1-1 fixed-padding3">
                                    <div class="uk-flex uk-flex-center uk-margin-small-bottom">
                                        <div>
                                            <div class="round-border round-border2 round-border-flex uk-flex uk-flex-center uk-flex-middle">
                                                <h4 class="round-border-text">{{package.type.sms}}</h4>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="uk-flex uk-flex-center fixed-padding3">
                                        <div class="border-text uk-padding-remove-left">SMS</div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="uk-margin-small-top uk-width-1-1 uk-flex uk-flex-center uk-padding">
                                    {% if package %}


                                      <div>

                                      <a href="{% url 'srm:packages:cancel_package' %}" class="srm-button srm-button-primary-outline crm_button-large crm-warning-button uk-margin-left">Cancel</a></button>

                                      </div>

                                    {% else %}
                                    <div><button class="srm-button srm-button-primary"><a href="{% url 'srm:packages:select_plan' %}" class="icon-colour">Purchase Plan</a></button></div>
                                    {% endif %}
                               </div>
                            </td>
                        </tr>
                    </form>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="uk-width-1-3@m">
            <div class="srm-card uk-padding-remove srm-contact-card payment-card">
                <div class="srm-page-heading srm-card-header-outside-right">
                    <a href="{% url 'srm:billings:payment-history' %}" ><header class="Payment-history"><img src="{% static 'crm/images/icon-3.png' %}" class="uk-margin-small-right">Payment history</header></a>
                </div>
                <div class="uk-card-header header-padding">
                    <h3 class="uk-card-title Recharge-SMS">Payment details</h3>
                </div>
                <div class="uk-flex uk-space-between space">
                    <div class="uk-card uk-card-small creditcard">
                        <span class="uk-margin-small-right card-number">****  ****  ****  ****  </span><span class="card-number">{{ card_last4 }}</span><br>
                        <span class="uk-margin-right billings-label">{{ card_name|default:"Default Card" }}</span><span class="billings-label">{{ expiration }}</span>
                    </div>
                    <div class="padright"><img src="{% static 'crm/images/mastercard-logo.png' %}"></div>
                </div>
                <table class="srm-contact-card-table border-table">
                    <tbody>
                    <form id="payment-form" method="post" action="{% url 'srm:billings:change_card_view' %}">{% csrf_token %}
                        <tr>
                            <td class="uk-padding-small uk-padding-remove-bottom">
                               <div class="">
                                    <label class="uk-form-label billings-label">Cardholder name</label>
                                    <div class="uk-form-controls">
                                      {% if card_last4 and card_type %}
                                        <input class="srm-input billings-input" id="" type="text" name="fullname" value='{{ card_name|default:"Default Card" }}'>
                                      {% else %}
                                        <input class="srm-input billings-input" id="" type="text" name="fullname">
                                      {% endif %}
                                    </div>
                                 </div>
                            </td>
                        </tr>
                        <tr>
                            <td class="uk-padding-small uk-padding-remove-bottom">
                               <div class="">
                                    <label class="uk-form-label billings-label">Card number</label>
                                    <div class="uk-form-controls">
                                      {% if card_last4 and card_type %}
                                        <input class="srm-input billings-input" id="" type="text" name="card_number" value="**** **** **** **** {{ card_last4 }}" readonly>
                                      {% else %}
                                        <input class="srm-input billings-input" id="" type="text" name="card_number">
                                      {% endif %}
                                    </div>
                                 </div>
                            </td>
                        </tr>
                        <tr>
                            <td class="uk-padding-small uk-padding-remove-bottom">
                                <div class="uk-child-width-1-3@m" data-uk-grid>
                                   <div>
                                        <label class="uk-form-label billings-label">Card CVV</label>
                                        <div class="uk-form-controls">
                                            <input class="srm-input billings-input" id="" type="text" value="***" name="cvc" readonly>
                                        </div>
{#                                            <input name="expiration" type="text" class="uk-hidden" id="expire">#}
                                   </div>
                                   <div>
                                        <label class="uk-form-label billings-label">Expiration date</label>
                                        <select class="srm-input billings-input crm-select" name="exp_month" ">
                                          {% if card_last4 and card_type %}
                                            <option value="{{exp_month}}">{{ exp_month }}</option>
                                          {% else %}
                                            <option value="">MM</option>
                                          {% endif %}
                                            <option value="01">01</option>
                                            <option value="02">02</option>
                                            <option value="03">03</option>
                                            <option value="04">04</option>
                                            <option value="05">05</option>
                                            <option value="06">06</option>
                                            <option value="07">07</option>
                                            <option value="08">08</option>
                                            <option value="09">09</option>
                                            <option value="10">10</option>
                                            <option value="11">11</option>
                                            <option value="12">12</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="uk-form-label billings-label hidden-label">Expiration date</label>
                                        <select class="srm-input billings-input crm-select" name="exp_year">
                                          {% if card_last4 and card_type %}
                                            <option value="{{exp_year}}">{{exp_year}}</option>
                                          {% else %}
                                            <option value="">YYYY</option>
                                          {% endif %}
                                            <option value="2018">18</option>
                                            <option value="2019">19</option>
                                            <option value="2020">20</option>
                                            <option value="2021">21</option>
                                            <option value="2022">22</option>
                                            <option value="2023">23</option>
                                        </select>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td class="uk-padding-small">
                                <div class="uk-width-1-1 uk-flex uk-flex-center uk-padding-small">
                                    <div><span class="Plan-renews-monthly">No charges will be made</span></div>
                               </div>
                                <div class="uk-width-1-1 uk-flex uk-flex-center uk-padding-small">
                                    <div><button class="srm-button srm-button-primary uk-margin-left" id="save_button">
                                      {% if card_last4 and card_type %}
                                      Save changes
                                      {% else %}
                                      <a href="{% url 'srm:packages:select_plan' %}" class="icon-colour">Purchase Plan</a>
                                      {% endif %}
                                    </button></div>
                               </div>
                                <div class="uk-width-1-1 uk-flex uk-flex-center">
                                    <div><span class="billings-label"><img src="{% static 'crm/images/locked-1.png' %}" class="uk-margin-small-right">Your data is SSL-secured</span></div>
                               </div>
                            </td>
                        </tr>
                    </form>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock body %}
{% include 'crm/marketing/campaigns/includes/numbers/buy-numbers-modal.html' %}
{% block extra_js %}
    <script src="{% static 'crm/js/marketing/campaigns/numbers.js' %}"></script>
{#    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>#}
{#    <script type="text/javascript" src="https://js.stripe.com/v2/"></script>#}
{#    <script type="text/javascript">#}
{#    var requiredFields = ["fullname", "city", "state", "country", "zipcode"];#}
{#    function stripeResponseHandler(status, response) {#}
{#      var $form = $('#payment-form');#}
{##}
{#      if (response.error) {#}
{#        // Show the errors on the form#}
{#        $form.find('.payment-errors').html('<i class="fa fa-warning"></i>' + response.error.message).show();#}
{#        $form.find('button').prop('disabled', false);#}
{#      } else {#}
{#        $form.find('.payment-errors').html("").hide();#}
{#        // response contains id and card, which contains additional card details#}
{#        var token = response.id;#}
{#        // Insert the token into the form so it gets submitted to the server#}
{#        $form.append($('<input type="hidden" name="stripeToken" />').val(token));#}
{#        // and submit#}
{#        $form.get(0).submit();#}
{#      }#}
{#    }#}
{##}
{#    $(function(){#}
{#        Stripe.setPublishableKey('{{ STRIPE_PUBLISHABLE_KEY }}');#}
{#        $('#payment-form').submit(function (e){#}
{#            var $form = $(this);#}
{#            var mm = $('#mm').val();#}
{#            var yy = $('#yy').val();#}
{#            var mmyy = mm.concat(yy);#}
{#            console.log(mmyy);#}
{#            // $('#expire').val() = mmyy#}
{##}
{#            $form.find('#save_button').prop('disabled', true);#}
{#            Stripe.createToken($form, stripeResponseHandler);#}
{#            return false;#}
{#        });#}
{#    });#}
{#    </script>#}
{% endblock extra_js %}
