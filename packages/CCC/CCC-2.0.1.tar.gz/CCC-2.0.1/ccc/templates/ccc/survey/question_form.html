{% extends 'ccc/campaigns/base.html' %}
{% load widget_tweaks staticfiles %}
{% block title%}{{ form_name }} {% endblock %}
{% block content %}
    <div class="row">
        <div class="col-md-12">
            <ul class="page-breadcrumb breadcrumb">
                <li>
                    <i class="fa fa-mobile"></i>
                    <a href="{% url 'survey_list' %}">
                        My Surveys
                    </a>
                    <i class="fa fa-angle-right"></i>
                </li>
                <li>
                    <a href="{% url 'survey_detail' survey.pk %}">
                        {{ survey.title }}
                    </a>
                    <i class="fa fa-angle-right"></i>
                </li>
                <li>
                    <a href="{% url 'question_create' survey_pk=survey.pk %}">
                        Create Survey Question
                    </a>
                </li>
            </ul>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <div class="portlet box grey">
                <div class="portlet-title">
                    <div class="caption">
                        <i class="fa fa-reorder"></i> {{ form_name }}
                    </div>
                </div>

                <div class="portlet-body form" style="min-height:500px">
                    <form role="form" method="post" class="form-horizontal">
                        {% csrf_token %}
                        <div class="form-body">
                            <div class="form-group">
                                <label class="col-md-3 control-label"> {{ form.question.label }}</label>
                                <div class="col-md-4">
                                    {% render_field form.question class="form-control" placeholder="Question" %}
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="col-md-3 control-label"> {{ form.question_type.label }}</label>
                                <div class="col-md-4">
                                    {% render_field form.question_type class="form-control" %}
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="col-md-3 control-label"> {{ form.contact_mapping.label }}</label>
                                <div class="col-md-4">
                                    {% render_field form.contact_mapping class="form-control" %}
                                </div>
                            </div>

                            {% for formset in inlines %}
                                {{ formset.management_form }}
                                {% for form in formset %}
                                  {% for hidden in form.hidden_fields %}
                                  {{ hidden }}
                                  {% endfor %}
                                <div class="form-group">
                                    <label class="col-md-3 control-label"> Answer {{ forloop.counter }}</label>
                                    <div class="col-md-4">
                                        {% render_field form.answer class="form-control" placeholder="Answer" %}
                                    </div>
                                    {% if form_name == "Update Question" %}
                                        <span id="delete_checkbox">{{ form.DELETE }} Delete</span>
                                        <small>(<a href="{% url 'question_create' survey_pk=question.survey.pk type='mcq' pk=form.initial.id %}">Add following question</a>)</small>
                                    {% endif %}
                                    {% if forloop.last %}
                                    <div class="col-md-offset-3 col-md-4 add-more">
                                        <p class="pull-right"><a href="javascript:void(0);" id="add-more-answer">Add more</a></p>
                                    </div>
                                    {% endif %}
                                </div>
                                {% endfor %}
                            {% endfor %}

                            <div class="form-group">
                                <label class="col-md-3 control-label">Send this question</label>
                                <div class="col-md-4">
                                    {% render_field form.schedular_step class="form-control scheduler_step" %}
                                </div>
                            </div>
                            
                            <div class="form-group" id="schedular_delay" style="display: none;">
                                <div class="col-md-4 col-md-offset-3">
                                    {% render_field form.delay class="form-control" placeholder="0" %}
                                </div>
                            </div>


                            {% if form.errors %}
                            <div class="alert alert-danger">
                                <p><strong>Error!</strong> </p>
                                {% for field in form %}
                                {% if field.errors %}
                                    {{ field.label }} {{ field.errors }}
                                {% endif %}
                                {% endfor %}
                            </div>
                            {% endif %}

                            <div class="form-actions fluid">
                                <div class="col-md-3" id="remaining_characters"></div>
                                <div class="col-md-9">
                                    <button class="btn blue" type="submit">{{ form_name }}</button>
                                {% if not form_name == "Update Question" %}
                                    <button class="btn" type="submit" name="add-to-all" value="1">Add followup to all responses</button>
                                {% endif %}
                                </div>
                            </div>

                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    <script type="text/javascript" src="{% static  'js/survey.js' %}"></script>
{% endblock scripts %}
