{% extends 'ccc/campaigns/base.html' %}
{% load tz static i18n staticfiles %}
{% block title %}Incoming Calls
{% endblock title %}
{% block css %}
<link rel="stylesheet" type="text/css" href="{% static 'assets/plugins/select2/select2.css' %}"/>
<link rel="stylesheet" type="text/css" href="{% static 'assets/plugins/select2/select2-metronic.css' %}"/>
<link rel="stylesheet" href="{% static 'assets/plugins/data-tables/DT_bootstrap.css' %}"/>
<link rel="stylesheet" type="text/css" href="{% static 'assets/plugins/bootstrap-datetimepicker/css/datetimepicker.css' %}"/>
<!-- END PAGE LEVEL STYLES -->
{% endblock css %}

{% block content %}
<!-- BEGIN PAGE HEADER-->
<div class="row">
    <div class="col-md-12 form-group ">
                    <label><b>Call Status</b></label>
                    <span id="call-status"></span>
                </div>
	<div class="col-md-12" align="center">
	<button class="btn btn-lg btn-danger hangup-button" onclick="hangUp()">
		Hang up
	</button>
	</div>
	<div class="col-md-12">
		<!-- BEGIN PAGE TITLE & BREADCRUMB-->
		<h3 class="page-title"> Incoming Calls <small></small></h3>
		<ul class="page-breadcrumb breadcrumb">

			<li>
				<i class="fa fa-volume-up"></i>
				<a href="#"> Received Calls </a>
				<i class="fa fa-angle-right"></i>
			</li>
			<li>
				<a href="/vco-report/"> Outgoing Calls </a>
				<i class="fa fa-angle-right"></i>
			</li>

			<li>
				<a href="/voice-campaigns/"> My Voice Campaigns </a>
			</li>
		</ul>
		<!-- END PAGE TITLE & BREADCRUMB-->
	</div>
</div>
<!-- END PAGE HEADER-->
<!-- BEGIN PAGE CONTENT-->
<div class="row">
	<div class="col-md-12">

		<!-- BEGIN EXAMPLE TABLE PORTLET-->
		<div class="portlet box blue">
			<div class="portlet-title">
				<div class="caption">
					<i class="fa fa-microphone"></i> Incoming Calls
				</div>
				<div class="actions">
					<div class="btn-group">
						<a class="btn default" href="#" data-toggle="dropdown"> Columns <i class="fa fa-angle-down"></i> </a>
						<div id="sample_2_column_toggler" class="dropdown-menu hold-on-click dropdown-checkboxes pull-right">
							<label>
								<input type="checkbox" checked data-column="0">
								Date</label>
							<label>
								<input type="checkbox" checked data-column="1">
								Campaign No</label>
							<label>
								<input type="checkbox" checked data-column="2">
								Campaign</label>
							<label>
								<input type="checkbox" checked data-column="3">
								Voice Message</label>
							<label>
								<input type="checkbox" checked data-column="4">
								Caller No</label>
							<label> <label>
									<input type="checkbox" checked data-column="4">
									Caller No</label> <label>
									<input type="checkbox" checked data-column="5">
									Country</label> <label>
									<input type="checkbox" checked data-column="6">
									City</label> <label>
									<input type="checkbox" checked data-column="7">
									Zip</label>
						</div>
					</div>
				</div>
			</div>
			<div class="portlet-body">
				<table class="table table-striped table-bordered table-hover table-full-width" id="sample_2">
					<thead>
						<tr>
							<th><i class="fa fa-calendar"></i> Date </th>
							<th><i class="fa fa-phone"></i> Campaign No </th>
							<th><i class="fa fa-bullhorn"></i> Campaign </th>
							<th><i class="fa fa-volume-up"></i> Voice Message </th>
							<th class="hidden-xs"><i class="fa fa-phone"></i> Caller No </th>

							<th class="hidden-xs"><i class="glyphicon glyphicon-earphone"></i> Call Back </th>
							<th class="hidden-xs"><i class="fa fa-globe"></i> Country </th>

							<th class="hidden-xs"> City </th>
							<th class="hidden-xs"> Zip </th>
							<th></th>

						</tr>
					</thead>
					<tbody>
						{% for vc in object_list %}

						<tr>
							<td> {{ vc.time }} </td>
							<td> {{ vc.to }} </td>
							<td> {{ vc.campaign.campaign.phone }} </td>
							<td> {% if vc.recording_url  %}
							<audio controls >

								<source src="{{ vc.recording_url }}.mp3" preload="auto" type="audio/mpeg">
								Browser Cant Play Audio
							</audio> {% else %}
							No Message Left
							{% endif %} </td>

							<td> {{ vc.from_no }} </td>
							<td>
							<button onclick="callbackfromcampaign('{{ vc.from_no }}', '{{ vc.to }}')" type="button" class="btn btn-primary btn-link call-customer-button">
								<span class="glyphicon glyphicon-earphone" aria-hidden="true"></span> Call customer
							</button></td>

							<td> {{ vc.from_country }} </td>

							<td> {{ vc.from_city }} </td>
							<td> {{ vc.from_zip }} </td>
							<td><a href="{% url 'delete_incoming_voice' vc.pk %}" class="delete-incoing-voice-call"><i class="fa fa-trash-o"></i> delete</a></td>
						</tr>

						{% endfor %}

					</tbody>
				</table>
			</div>
		</div>
		<!-- END EXAMPLE TABLE PORTLET-->
	</div>
</div>

{% csrf_token %}

{% endblock content %}

{% block scripts %}

<style>
	.audiojs {
		max-width: 220px;
		padding: 1px 1px;
		max-height: 30px;
		margin-top: -5px;
	}
	.scrubber {
		max-width: 50px;
	}
	.audiojs .play-pause {
		width: 40px;
	}
</style>

<!-- BEGIN PAGE LEVEL PLUGINS -->
<script type="text/javascript" src="{% static 'assets/plugins/select2/select2.min.js' %}"></script>
<script type="text/javascript" src="{% static 'assets/plugins/data-tables/jquery.dataTables.min.js' %}"></script>
<script type="text/javascript" src="{% static 'assets/plugins/data-tables/DT_bootstrap.js' %}"></script>
<script src="{% static 'assets/scripts/custom/tasks.js' %}" type="text/javascript"></script>
<script type="text/javascript" src="{% static 'assets/plugins/bootstrap-wysihtml5/wysihtml5-0.3.0.js' %}"></script>
<script type="text/javascript" src="{% static 'assets/plugins/bootstrap-wysihtml5/bootstrap-wysihtml5.js' %}"></script>
<script src="{% static 'assets/scripts/custom/components-editors.js' %}"></script>
<script type="text/javascript" src="{% static 'assets/plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js' %}"></script>

<script src="{% static 'assets/scripts/custom/components-pickers.js' %}"></script>

<!-- END PAGE LEVEL PLUGINS -->
<!-- BEGIN PAGE LEVEL SCRIPTS -->

<script src="{% static 'assets/scripts/custom/table-advanced.js' %}"></script>
<script type="text/javascript"src="{% static 'js/twilio.min.js' %}"></script>
<script type="text/javascript" src="{% static 'js/browser-calls.js' %}"></script>
<script>
	jQuery(document).ready(function() {

		TableAdvanced.init();

		$('#show_schedule').click(function() {
			$('#schedule').toggle()
		});
		$('#dates').change(function() {
			var opt = $("#dates option").filter(":selected").val();
			if (opt == 1) {
				$('#mini-schedule').show()
			} else {
				$('#mini-schedule').hide()
			}

		});

		$(document).on('click', '.delete-incoing-voice-call', function() {
			if (!confirm("Are you sure to delete this call record?"))
				return false;

			$.ajax({
				url : $(this).attr("href"),
				type : "POST",
				data : {
					'csrfmiddlewaretoken' : $('input[name=csrfmiddlewaretoken]').val()
				},
				success : function(response, textStatus, jqXHR) {
					window.location.reload();
				},
				error : function(jqXHR, textStatus, errorThrown) {
					if ((jqXHR.responseJSON) && (jqXHR.responseJSON.error)) {
						alert(jqXHR.responseJSON.error);
					}
				}
			});

			return false;

		})
	}); 
</script>

{% endblock scripts %}

