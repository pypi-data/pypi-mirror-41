{% extends "base.html" %}
{% load static %}
{% load i18n %}
{% load django_th_extras %}
{% block title %}{% if user.is_authenticated %}{% trans "My Triggers" %} - {{ user.username }} - {% else %}{% trans "Home" %} - {% endif %}Trigger Happy{% endblock %}
{% block content %}
    <div v-for="trigger in trigger_list" v-if="trigger.provider.name.status and trigger.consumer.name.status">
        <div id="trigger-record-{{ trigger.id }}" class="trigger-record col-xs-12 col-md-12 col-lg-12">
            <div class="col-xs-7 col-md-7 col-lg-7">
                <a class="btn btn-sm btn-md btn-lg btn-default" href="{% url 'edit_trigger' trigger.id %}" title="{% trans 'Edit the description' %} "> {{ trigger.description|safe|escape }}</a>
                <a class="btn btn-sm btn-md btn-lg btn-default" role="button" href="{% url 'edit_provider' trigger.id %}" title="{% trans 'Edit your service' %} {{ trigger.provider.name|service_readable|lower }}" >{{ trigger.provider.name|service_readable|lower }} <i class="fa fa-{{ trigger.provider.name|service_readable_class|lower }}" aria-hidden="true"></i></a>
                <a class="btn btn-sm btn-md btn-lg btn-default" role="button" href="{% url 'edit_consumer' trigger.id %}" title="{% trans 'Edit your service' %} {{ trigger.consumer.name|service_readable|lower }}" >{{ trigger.consumer.name|service_readable|lower }} <i class="fa fa-{{ trigger.consumer.name|service_readable_class|lower }}" aria-hidden="true"></i></a>
            </div>
            <div class="col-xs-5 col-md-5 col-lg-5">
                {%  if fire %}
                <a class="btn btn-sm btn-md btn-lg btn-default" data="{{ trigger.id }}" role="button" href="#" title="{% trans 'Fire this trigger now !' %}"><span class="glyphicon glyphicon-fire icon-white"></span></a>
                {%  endif  %}
                {% if trigger.status %}
                <a class="btn btn-sm btn-md btn-lg btn-primary" data="{{ trigger.id }}" role="button" href="#" title="{% trans 'Set this trigger off' %}"><span class="glyphicon glyphicon-off icon-white"></span></a>
                {% else %}
                <a class="btn btn-sm btn-md btn-lg btn-success" data="{{ trigger.id }}" role="button" href="#" title="{% trans 'Set this trigger on' %}"><span class="glyphicon glyphicon-off icon-white"></span></a>
                {% endif %}
                <a class="btn btn-sm btn-md btn-lg btn-danger" role="button" href="{% url 'delete_trigger' trigger.id %}" title="{% trans 'Delete this trigger ?' %}"><span class="glyphicon glyphicon-trash icon-white"></span></a><br/>

            </div>
            <footer>
                <div id="trigger-footer-{{ trigger.id }}" class="col-xs-12 col-md-12 col-lg-12">
                    <p>
                        <span class="glyphicon glyphicon-calendar"></span>&nbsp;{% trans "Created" %}&nbsp;{{ trigger.date_created }}
                        &nbsp;-&nbsp;
                        <span class="glyphicon glyphicon-calendar"></span>&nbsp;{% trans "Triggered" %}&nbsp;{% if trigger.date_triggered %}{{ trigger.date_triggered }}{% else %}&nbsp;{% trans "Never triggered" %}{% endif %}
                    </p>
                    {%  if trigger.consumer.name.name == 'ServiceRss' %}
                    <p class="text-ok"><a href="{% url 'edit_consumer' trigger.id %}" >{% trans "Click here to see your Feeds URL for" %} {{ trigger.provider.name|service_readable_class|lower }}</a></p>
                    {%  endif %}
                    <p class="text-{% if trigger.result == 'OK' %}info{%  else  %}warning{%  endif %}">
                        <span class="glyphicon glyphicon-bullhorn"></span> {{ trigger.result }} - {{ trigger.date_result }}
                        <br>
                        <span class="badge">{{ trigger.counter_ok }}</span> {%  trans "ran successfully" %} - <span class="badge">{{ trigger.counter_ko }}</span> {%  trans "failed" %}
                    </p>
                </div>
            </footer>
        </div>
    </div>
    <div v-else id="trigger-record-{{ trigger.id }}" class="trigger-record col-xs-12 col-md-12 col-lg-12 {{ trigger|trigger_disabled }}">
          <div class="col-xs-7 col-md-7 col-lg-7">
              <a class="btn btn-sm btn-md btn-lg btn-default" role="button"> {{ trigger.description|safe|escape }}</a>
              <a class="btn btn-sm btn-md btn-lg btn-default" role="button" title="{{ trigger.provider.name|service_readable|lower }}" >{{ trigger.provider.name|service_readable|lower }} <i class="fa fa-{{ trigger.provider.name|service_readable_class|lower }}" aria-hidden="true"></i></a>
              <a class="btn btn-sm btn-md btn-lg btn-default" role="button" title="{{ trigger.consumer.name|service_readable|lower }}" >{{ trigger.consumer.name|service_readable|lower }} <i class="fa fa-{{ trigger.consumer.name|service_readable_class|lower }}" aria-hidden="true"></i></a>
          </div>
          <div class="col-xs-5 col-md-5 col-lg-5">
              Trigger disabled due to admin activity who disable one of the 2 services {{ trigger.provider.name|service_readable|lower }} or {{ trigger.consumer.name|service_readable|lower }} or both of them
          </div>
          <footer>
              <div id="trigger-footer-{{ trigger.id }}" class="col-xs-12 col-md-12 col-lg-12">
                  <p>
                      <span class="glyphicon glyphicon-calendar"></span>&nbsp;{% trans "Created" %}&nbsp;{{ trigger.date_created }}
                      &nbsp;-&nbsp;
                      <span class="glyphicon glyphicon-calendar"></span>&nbsp;{% trans "Triggered" %}&nbsp;{% if trigger.date_triggered %}{{ trigger.date_triggered }}{% else %}&nbsp;{% trans "Never triggered" %}{% endif %}
                  </p>
                  <p class="text-{% if trigger.result == 'OK' %}info{%  else  %}warning{%  endif %}">
                      <span class="glyphicon glyphicon-bullhorn"></span> {{ trigger.result }} - {{ trigger.date_result }}
                  </p>
              </div>
          </footer>
    </div>
{% endblock %}
{% block extrajs %}
<script src="{% url 'js_reverse' %}" type="text/javascript"></script>
<script src="{% static 'js/th_vue.js' %}" type="text/javascript"></script>
{% endblock %}
