(function(){if(window.DMP_CONTEXT){return;}
window.DMP_CONTEXT={__version__:'5.7.20',contexts:{},contextsByName:{},lastContext:null,bundleFunctions:{},logEnabled:null,set:function(version,contextid,data,templates){DMP_CONTEXT.logEnabled=DMP_CONTEXT.logEnabled||data.__router__.log;if(DMP_CONTEXT.__version__!=version){DMP_CONTEXT.log(['Framework version on server is',version,' but dmp-common.js is',DMP_CONTEXT.__version__,'- unexpected behavior may occur.']);}
DMP_CONTEXT.contexts[contextid]={id:contextid,data:data,templates:templates,pendingCalls:0};DMP_CONTEXT.lastContext=DMP_CONTEXT.contexts[contextid];for(var i=0;i<templates.length;i++){if(typeof DMP_CONTEXT.contextsByName[templates[i]]==="undefined"){DMP_CONTEXT.contextsByName[templates[i]]=[];}
DMP_CONTEXT.contextsByName[templates[i]].push(contextid);}
DMP_CONTEXT.log(["Context"],DMP_CONTEXT.contexts[contextid]);},get:function(option){var ret=DMP_CONTEXT.getAll(option);if(ret.length==0){return undefined;}
return ret[ret.length-1];},getAll:function(option){var ret=[];if(!option&&document.currentScript&&document.currentScript.getAttribute('data-context')){option=document.currentScript;}
if(!option&&DMP_CONTEXT.lastContext){ret.push(DMP_CONTEXT.lastContext.data);}
else if(typeof option==='string'||option instanceof String){var contextids=DMP_CONTEXT.contextsByName[option];if(typeof contextids!=="undefined"){for(var i=0;i<contextids.length;i++){var c=DMP_CONTEXT.contexts[contextids[i]];if(typeof c!=="undefined"){ret.push(c.data);}}}}
else if(option&&option.nodeType===1&&option.nodeName.toLowerCase()=='script'&&option.getAttribute('data-context')){var c=DMP_CONTEXT.contexts[option.getAttribute('data-context')];if(typeof c!=="undefined"){ret.push(c.data);}}
return ret;},loadBundle(template_functions){var templates=Object.keys(template_functions);DMP_CONTEXT.log(['Linking ',templates.length,'functions'],templates);for(var i=0;i<templates.length;i++){DMP_CONTEXT.bundleFunctions[templates[i]]=template_functions[templates[i]];}},checkBundleLoaded(contextid){var context=DMP_CONTEXT.contexts[contextid];if(typeof context==="undefined"){return;}
var notLoaded=[];for(var i=0;i<context.templates.length;i++){var template=context.templates[i];if(typeof DMP_CONTEXT.bundleFunctions[template]==="undefined"){notLoaded.push(template);}}
if(notLoaded.length>0){DMP_CONTEXT.log(['Context',contextid,'waiting for',notLoaded.length,'functions to link'],notLoaded);return;}
while(context.pendingCalls>0){context.pendingCalls=Math.max(0,context.pendingCalls-1);for(var i=0;i<context.templates.length;i++){DMP_CONTEXT.log(['Calling',context.templates[i]]);DMP_CONTEXT.bundleFunctions[context.templates[i]]();}}},callBundleContext(contextid){var context=DMP_CONTEXT.contexts[contextid];if(typeof context==="undefined"){return;}
context.pendingCalls++;DMP_CONTEXT.checkBundleLoaded(contextid);},log(messages,data){if(DMP_CONTEXT.logEnabled){console.debug('[DMP] '+messages.join(' '),data||'');}},};})()