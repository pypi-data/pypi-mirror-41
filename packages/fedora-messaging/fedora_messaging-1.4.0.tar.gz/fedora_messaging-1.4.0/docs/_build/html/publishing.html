
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Publishing &#8212; Fedora Messaging 1.1.0 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Consumers" href="consuming.html" />
    <link rel="prev" title="Configuration" href="configuration.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="publishing">
<span id="id1"></span><h1>Publishing<a class="headerlink" href="#publishing" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Publishing messages is simple. Messages are made up of a topic, some optional
headers, and a body. Messages are encapsulated in a
<a class="reference internal" href="api.html#fedora_messaging.message.Message" title="fedora_messaging.message.Message"><code class="xref py py-class docutils literal notranslate"><span class="pre">fedora_messaging.message.Message</span></code></a> object. For details on defining
messages, see the <a class="reference internal" href="messages.html#messages"><span class="std std-ref">Messages</span></a> documentation. For details on the publishing
API, see the <a class="reference internal" href="api.html#pub-api"><span class="std std-ref">Publishing</span></a> API documentation.</p>
<div class="section" id="topics">
<h3>Topics<a class="headerlink" href="#topics" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://www.rabbitmq.com/amqp-0-9-1-reference.html#queue.bind.routing-key">Topics</a> are strings of words separated by the <code class="docutils literal notranslate"><span class="pre">.</span></code> character, up to 255
characters. Topics are used by clients to filter messages, so choosing a good
topic helps reduce the number of messages sent to a client. Topics should start
broadly and become more specific.</p>
</div>
<div class="section" id="headers">
<h3>Headers<a class="headerlink" href="#headers" title="Permalink to this headline">¶</a></h3>
<p>Headers are key-value pairs attached that are useful for storing information
about the message itself. This library adds a header to every message with the
<code class="docutils literal notranslate"><span class="pre">fedora_messaging_schema</span></code> key, pointing to the message schema used.</p>
<p>You should not use any key starting with <code class="docutils literal notranslate"><span class="pre">fedora_messaging</span></code> for yourself.</p>
<p>You can write <a class="reference internal" href="messages.html#header-schema"><span class="std std-ref">Header Schema</span></a> for your messages to enforce a particular
schema.</p>
</div>
<div class="section" id="body">
<h3>Body<a class="headerlink" href="#body" title="Permalink to this headline">¶</a></h3>
<p>The only restrictions on the message body is that it must be serializable to a
JSON object. You should write a <a class="reference internal" href="messages.html#body-schema"><span class="std std-ref">Body Schema</span></a> for your messages to ensure
you don’t change your message format unintentionally.</p>
</div>
</div>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>To publish a message, first create a <a class="reference internal" href="api.html#fedora_messaging.message.Message" title="fedora_messaging.message.Message"><code class="xref py py-class docutils literal notranslate"><span class="pre">fedora_messaging.message.Message</span></code></a>
object, then pass it to the <a class="reference internal" href="api.html#fedora_messaging.api.publish" title="fedora_messaging.api.publish"><code class="xref py py-func docutils literal notranslate"><span class="pre">fedora_messaging.api.publish()</span></code></a> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">fedora_messaging</span> <span class="k">import</span> <span class="n">api</span><span class="p">,</span> <span class="n">message</span>

<span class="n">msg</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">Message</span><span class="p">(</span><span class="n">topic</span><span class="o">=</span><span class="sa">u</span><span class="s1">&#39;nice.message&#39;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="sa">u</span><span class="s1">&#39;niceness&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;very&#39;</span><span class="p">},</span>
                      <span class="n">body</span><span class="o">=</span><span class="p">{</span><span class="sa">u</span><span class="s1">&#39;encouragement&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s2">&quot;You&#39;re doing great!&quot;</span><span class="p">})</span>
<span class="n">api</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</pre></div>
</div>
<p>The API relies on the <a class="reference internal" href="configuration.html#config"><span class="std std-ref">Configuration</span></a> you’ve provided to connect to the message
broker and publish the message to an exchange.</p>
</div>
<div class="section" id="handling-errors">
<h2>Handling Errors<a class="headerlink" href="#handling-errors" title="Permalink to this headline">¶</a></h2>
<p>Your message might fail to publish for a number of reasons, so you should be
prepared to see (and potentially handle) some errors.</p>
<div class="section" id="validation">
<h3>Validation<a class="headerlink" href="#validation" title="Permalink to this headline">¶</a></h3>
<p>The message you create may not be successfully validated against its schema.
This is not an error you should catch, since it must be fixed by the developer
and cannot be recovered from.</p>
</div>
<div class="section" id="connection-errors">
<h3>Connection Errors<a class="headerlink" href="#connection-errors" title="Permalink to this headline">¶</a></h3>
<p>The publish API will attempt to reconnect to the broker several times before an
exception is raised. Once this occurs it is up to the application to decide what
to do.</p>
</div>
<div class="section" id="rejected-messages">
<h3>Rejected Messages<a class="headerlink" href="#rejected-messages" title="Permalink to this headline">¶</a></h3>
<p>The broker may reject a message. This could occur because the message is too
large, or because the publisher does not have permission to publish messages
with a particular topic, or some other reason.</p>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Fedora Messaging</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=fedora-infra&repo=fedora-messaging&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Publishing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#handling-errors">Handling Errors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="consuming.html">Consumers</a></li>
<li class="toctree-l1"><a class="reference internal" href="messages.html">Messages</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Release Notes</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="fedora-messaging.html">fedora-messaging</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorial/index.html">Using Fedora Messaging</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api.html">Developer Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="wire-format.html">Message Format</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="configuration.html" title="previous chapter">Configuration</a></li>
      <li>Next: <a href="consuming.html" title="next chapter">Consumers</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Red Hat, Inc.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/publishing.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>