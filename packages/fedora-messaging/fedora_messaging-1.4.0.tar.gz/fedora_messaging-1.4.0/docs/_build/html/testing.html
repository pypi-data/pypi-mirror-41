
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Testing &#8212; Fedora Messaging 1.1.0 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Release Notes" href="changelog.html" />
    <link rel="prev" title="Messages" href="messages.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="testing">
<span id="id1"></span><h1>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h1>
<span class="target" id="module-fedora_messaging.testing"></span><p>Once you’ve written code to publish or consume messages, you’ll probably want
to test it. The <a class="reference internal" href="#module-fedora_messaging.testing" title="fedora_messaging.testing"><code class="xref py py-mod docutils literal notranslate"><span class="pre">fedora_messaging.testing</span></code></a> module has utilities for common
test patterns.</p>
<p>If you find yourself implementing a pattern over and over in your test code,
consider contributing it here!</p>
<dl class="function">
<dt id="fedora_messaging.testing.mock_sends">
<code class="descclassname">fedora_messaging.testing.</code><code class="descname">mock_sends</code><span class="sig-paren">(</span><em>*expected_messages</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/fedora_messaging/testing.html#mock_sends"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#fedora_messaging.testing.mock_sends" title="Permalink to this definition">¶</a></dt>
<dd><p>Assert a block of code results in the provided messages being sent without
actually sending them.</p>
<p>This is intended for unit tests. The call to publish is mocked out and messages
are captured and checked at the end of the <code class="docutils literal notranslate"><span class="pre">with</span></code>.</p>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">fedora_messaging</span> <span class="k">import</span> <span class="n">api</span><span class="p">,</span> <span class="n">testing</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">publishes</span><span class="p">():</span>
<span class="gp">... </span>    <span class="n">api</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">api</span><span class="o">.</span><span class="n">Message</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Hello&quot;</span><span class="p">:</span> <span class="s2">&quot;world&quot;</span><span class="p">}))</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">testing</span><span class="o">.</span><span class="n">mock_sends</span><span class="p">(</span><span class="n">api</span><span class="o">.</span><span class="n">Message</span><span class="p">,</span> <span class="n">api</span><span class="o">.</span><span class="n">Message</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Hello&quot;</span><span class="p">:</span> <span class="s2">&quot;world&quot;</span><span class="p">})):</span>
<span class="gp">... </span>    <span class="n">publishes</span><span class="p">()</span>
<span class="gp">... </span>    <span class="n">publishes</span><span class="p">()</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">testing</span><span class="o">.</span><span class="n">mock_sends</span><span class="p">(</span><span class="n">api</span><span class="o">.</span><span class="n">Message</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Goodbye&quot;</span><span class="p">:</span> <span class="s2">&quot;everybody&quot;</span><span class="p">})):</span>
<span class="gp">... </span>    <span class="n">publishes</span><span class="p">()</span>
<span class="gp">...</span>
<span class="go">AssertionError</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>*expected_messages</strong> – The messages you expect to be sent. These can be classes
instances of classes derived from <a class="reference internal" href="api.html#fedora_messaging.message.Message" title="fedora_messaging.message.Message"><code class="xref py py-class docutils literal notranslate"><span class="pre">fedora_messaging.message.Message</span></code></a>.
If the class is provided, the message is checked to make sure it is an
instance of that class and that it passes schema validation. If an instance
is provided, it is checked for equality with the sent message.</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#AssertionError" title="(in Python v3.7)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">AssertionError</span></code></a> – If the messages published don’t match the messages asserted.</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Fedora Messaging</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=fedora-infra&repo=fedora-messaging&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="publishing.html">Publishing</a></li>
<li class="toctree-l1"><a class="reference internal" href="consuming.html">Consumers</a></li>
<li class="toctree-l1"><a class="reference internal" href="messages.html">Messages</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Release Notes</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="fedora-messaging.html">fedora-messaging</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorial/index.html">Using Fedora Messaging</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api.html">Developer Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="wire-format.html">Message Format</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="messages.html" title="previous chapter">Messages</a></li>
      <li>Next: <a href="changelog.html" title="next chapter">Release Notes</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Red Hat, Inc.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/testing.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>