webpackJsonp([1],{"/Paa":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("gRE1"),s=a.n(i),n=a("pFYg"),o=a.n(n),r=a("W3Iv"),l=a.n(r),u=a("BO1k"),d=a.n(u),c=a("d7EF"),h=a.n(c),m=a("mvHQ"),f=a.n(m),p=a("INCx"),_=a.n(p),g=a("bOdI"),b=a.n(g),v=(a("mw3O"),a("X2Oc")),y={name:"node",components:{TaskDrag:a("Fsn0").default},data:function(){var t;return t={op_type:"add",isRouterAlive:!0,loading:!0,color:"#66b1ff",checked:{},authNode:"",layout_add_url:"/api/layout/add",layout_update_url:"/api/layout/update",list_url:"/api/layout/list",layout_del_url:"/api/layout/del",del_list:new URLSearchParams,disable_list:[],checkAll:!1,checkedCities:[],total_nodes:[],nodes:[],isIndeterminate:!0,tableData:[],select_group:"",selected_group:null,select_status:"",select_word:"",cur_page:1,page_size:10,total:0},b()(t,"loading",null),b()(t,"multipleSelection",[]),b()(t,"is_search",!1),b()(t,"detailVisible",!1),b()(t,"authVisible",!1),b()(t,"editVisible",!1),b()(t,"delVisible",!1),b()(t,"createVisible",!1),b()(t,"form",{id:"",layout_name:"",layout:{}}),b()(t,"cur_node_detail",{sysinfo:{RAM_USAGE:.1,CPU_USAGE:.1,LOAD_AVG:.1,task_list:{TASK_ID:"TASK_ID",PLUGIN_NAME:"BashPlugin"},heartbeat_time:1533274697.336775,LOGICAL_CPU_CORE_NUM:4,addr:["10.100.60.112",38920]}}),t},created:function(){for(var t in this.getData(),this.cities)this.$set(this.checked,t,[]);this.getGroupList()},computed:{data:function(){}},filters:{formatDate:function(t){var e=new Date(_()(1e3*t));return Object(v.a)(e,"yyyy-MM-dd HH:mm:ss")},formatGroupName:function(t){var e="";for(var a in t)e+=t[a].group_name+",";return e},statusFilter:function(t){return{2:"success",0:"info",1:"danger",4:"danger"}[t]},statusNameFilter:function(t){return{1:"Token Ready",0:"未授权",2:"已授权",3:"在线",4:"离线"}[t]}},methods:{updatePage:function(){this.$router.go(0)},doCreate:function(t,e){var a=this;"add"==e?(this.form.layout=f()(t),this.$axios.post(this.layout_add_url,this.trans_params(this.form)).then(function(t){1==t.data.status?(a.$message.success("编排添加成功"),a.getData()):a.$message.error("编排添加失败, 错误码:"+t.data.status+t.data.msg),a.createVisible=!1})):(this.form.layout=f()(t),this.$axios.post(this.layout_update_url,this.trans_params(this.form)).then(function(t){1==t.data.status?(a.$message.success("编排保存成功"),a.getData()):a.$message.error("编排保存失败, 错误码:"+t.data.status+t.data.msg),a.editVisible=!1}))},getGroupList:function(){var t=this;this.$axios.get("/api/group/list",{params:{status:1}}).then(function(e){t.select_group=e.data.result,t.total_nodes||(t.total_nodes=e.data.result),t.nodes=e.data.result})},handleChange:function(){this.$emit("change",this.checked)},handleDetail:function(t){this.getData(),this.cur_node_detail=t,this.detailVisible=!0},handleCheckAllChange:function(t){this.isIndeterminate=!1},handleCheckedCitiesChange:function(t){var e=t.length;this.checkAll=e===this.nodes.length,this.isIndeterminate=e>0&&e<this.nodes.length},handbleAuth:function(t,e){var a=e;this.form.id=a.id,this.getGroupList(),this.authVisible=!0},trans_params:function(t){var e=new URLSearchParams,a=!0,i=!1,n=void 0;try{for(var r,u=d()(l()(t));!(a=(r=u.next()).done);a=!0){var c=r.value,m=h()(c,2),f=m[0],p=m[1];if("object"==(void 0===p?"undefined":o()(p))){var _=!0,g=!1,b=void 0;try{for(var v,y=d()(s()(p));!(_=(v=y.next()).done);_=!0){var C=v.value;e.append(f,C)}}catch(t){g=!0,b=t}finally{try{!_&&y.return&&y.return()}finally{if(g)throw b}}}else e.append(f,p)}}catch(t){i=!0,n=t}finally{try{!a&&u.return&&u.return()}finally{if(i)throw n}}return e},doAuth:function(){var t=this;this.form.group_id=this.checkedCities,""!=this.form.node_name?(this.form.op="enable",this.$axios.post(this.node_auth_url,this.trans_params(this.form)).then(function(e){1==e.data.status?(t.$message.success("节点授权成功"),t.getData()):t.$message.error("节点授权失败, 错误码:"+e.data.status+e.data.msg),t.authVisible=!1})):this.$message.error("节点名称不能为空")},doEdit:function(){var t=this;this.form.op="edit",this.$axios.post(this.node_auth_url,this.trans_params(this.form)).then(function(e){1==e.data.status?(t.$message.success("节点编辑成功"),t.getData()):t.$message.error("节点编辑失败, 错误码:"+e.data.status+e.data.msg),t.editVisible=!1})},handleSizeChange:function(t){this.page_size=t,this.getData()},handleCurrentChange:function(t){this.cur_page=t,this.getData()},getData:function(){var t=this;this.$axios.get(this.list_url,{params:{page_index:this.cur_page,group_id:this.selected_group,search:this.select_word,node_status:this.select_status,page_size:this.page_size}}).then(function(e){t.tableData=e.data.result,t.total=e.data.count})},search:function(){this.getData()},handleEdit:function(t,e){this.op_type="edit",this.form.op="edit",this.form.id=e.id,this.form.name=e.name,this.form.layout=JSON.parse(e.layout),this.$refs.my_task_layout&&console.log(this.$refs.my_task_layout),this.editVisible=!0},deleteNode:function(){var t=this;this.$confirm("是否确认此操作","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(function(){t.$axios.post(t.node_del_url,t.del_list).then(function(e){1==e.data.status?(t.getData(),t.$message.success("删除成功")):t.$message.error("删除失败, 错误码:"+e.data.status)})}).catch(function(){t.$message({type:"info",message:"操作已取消"})})},diableNode:function(){var t=this;this.$confirm("是否确认此操作","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(function(){t.diableNode.append("op","disable"),t.$axios.post(t.node_disable_url,t.disable_list).then(function(e){1==e.data.status?(t.getData(),t.$message.success("删除成功")):t.$message.error("删除失败, 错误码:"+e.data.status)})}).catch(function(){t.$message({type:"info",message:"操作已取消"})})},handleSelectionChange:function(t){this.multipleSelection=t},nodeDel:function(t){var e=this;this.$confirm("是否确认此操作","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(function(){e.$axios.post(e.layout_del_url,e.trans_params({id:t})).then(function(t){1==t.data.status?(e.getData(),e.$message.success("删除成功")):e.$message.error("删除失败, 错误码:"+t.data.status)})}).catch(function(){e.$message({type:"info",message:"操作已取消"})})},batchDisable:function(){var t=this.multipleSelection.length;this.enable_list=new URLSearchParams;for(var e=0;e<t;e++)this.enable_list.append("id",this.multipleSelection[e].id);this.diableNode()},batchDel:function(){var t=this.multipleSelection.length;this.del_list=new URLSearchParams;for(var e=0;e<t;e++)this.del_list.append("id",this.multipleSelection[e].id);this.deleteNode(),this.getData()}}},C={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"table"},[a("div",{staticClass:"crumbs"},[a("el-breadcrumb",{attrs:{separator:"/"}},[a("el-breadcrumb-item",[a("i",{staticClass:"el-icon-tickets"}),t._v(" 任务")]),t._v(" "),a("el-breadcrumb-item",[t._v("任务编排")])],1)],1),t._v(" "),a("div",{staticClass:"container"},[a("div",{staticClass:"handle-box"},[a("el-button",{attrs:{type:"primary",icon:"search",size:"mini"},on:{click:function(e){t.createVisible=!0,t.op_type="add"}}},[t._v("新建")]),t._v(" "),a("el-input",{staticClass:"handle-input mr10",attrs:{size:"mini",placeholder:"请输入关键词"},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;t.search()}},model:{value:t.select_word,callback:function(e){t.select_word=e},expression:"select_word"}}),t._v(" "),a("el-button",{attrs:{type:"primary",icon:"search",size:"mini"},on:{click:t.search}},[t._v("搜索")])],1),t._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:t.tableData,border:""},on:{"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{prop:"id",label:"ID","min-width":"150"}}),t._v(" "),a("el-table-column",{attrs:{prop:"name",label:"编排名称","min-width":"150"}}),t._v(" "),a("el-table-column",{attrs:{prop:"update_time",label:"更新时间","min-width":"180"}}),t._v(" "),a("el-table-column",{attrs:{label:"操作",width:"320"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{directives:[{name:"tooltip",rawName:"v-tooltip",value:"编辑任务编排",expression:"'编辑任务编排'"}],attrs:{size:"mini"},on:{click:function(a){t.handleEdit(e.$index,e.row)}}},[a("i",{staticClass:"el-icon-bianji2  iconfont_no_margin sumeru_op_button"})]),t._v(" "),a("span",{directives:[{name:"tooltip",rawName:"v-tooltip",value:"删除任务编排",expression:"'删除任务编排'"}],attrs:{size:"mini",type:"danger"},on:{click:function(a){t.nodeDel(e.row.id)}}},[a("i",{staticClass:"el-icon-shanchu1    iconfont_no_margin sumeru_op_button sumeru_red"})])]}}])})],1),t._v(" "),a("div",{staticClass:"pagination"},[a("el-pagination",{attrs:{"current-page":t.cur_page,"page-sizes":[10,20,50,100],"page-size":t.page_size,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange,"update:currentPage":function(e){t.cur_page=e},"update:pageSize":function(e){t.page_size=e},"update:total":function(e){t.total=e}}})],1)],1),t._v(" "),a("el-dialog",{attrs:{title:"创建任务编排",visible:t.createVisible,width:"50%"},on:{"update:visible":function(e){t.createVisible=e},close:t.updatePage}},[a("el-form",{ref:"form",attrs:{model:t.form,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"编排名称"}},[a("el-input",{attrs:{clearable:""},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"任务编排"}},[a("task-drag",{ref:"my_task_layout",attrs:{"layout-data":t.form.layout,"dialog-type":t.op_type},on:{listenAddEvent:t.doCreate}})],1)],1),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"})],1),t._v(" "),a("el-dialog",{attrs:{title:"编辑任务编排",visible:t.editVisible,width:"50%"},on:{"update:visible":function(e){t.editVisible=e},close:t.updatePage}},[a("el-form",{ref:"form",attrs:{model:t.form,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"编排名称"}},[a("el-input",{attrs:{clearable:""},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:""}},[a("task-drag",{attrs:{"layout-data":t.form.layout,"dialog-type":t.op_type},on:{listenAddEvent:t.doCreate}})],1)],1),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"})],1)],1)},staticRenderFns:[]};var $=a("VU/8")(y,C,!1,function(t){a("ixDx")},"data-v-545ee318",null);e.default=$.exports},"9bBU":function(t,e,a){a("mClu");var i=a("FeBl").Object;t.exports=function(t,e,a){return i.defineProperty(t,e,a)}},C4MV:function(t,e,a){t.exports={default:a("9bBU"),__esModule:!0}},bOdI:function(t,e,a){"use strict";e.__esModule=!0;var i,s=a("C4MV"),n=(i=s)&&i.__esModule?i:{default:i};e.default=function(t,e,a){return e in t?(0,n.default)(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}},ixDx:function(t,e){},mClu:function(t,e,a){var i=a("kM2E");i(i.S+i.F*!a("+E39"),"Object",{defineProperty:a("evD5").f})}});