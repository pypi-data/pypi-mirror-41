webpackJsonp([6],{ulLU:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("gRE1"),s=a.n(i),n=a("pFYg"),l=a.n(n),o=a("W3Iv"),r=a.n(o),c=a("BO1k"),d=a.n(c),u=a("d7EF"),h=a.n(u),_=a("INCx"),p=a.n(_),m=(a("mw3O"),a("X2Oc")),f={name:"node",data:function(){return{checked:{},authNode:"",node_auth_url:"/api/dnode/modify",list_url:"/api/dnode/list",node_del_url:"/api/dnode/del",del_list:new URLSearchParams,disable_list:[],checkAll:!1,checkedCities:[],total_nodes:[],nodes:[],isIndeterminate:!0,tableData:[],select_group:"",selected_group:null,select_status:"",select_word:"",cur_page:1,page_size:10,total:0,loading:null,multipleSelection:[],is_search:!1,detailVisible:!1,authVisible:!1,editVisible:!1,delVisible:!1,form:{node_name:"",id:"",group_id:[]},cur_node_detail:{sysinfo:{RAM_USAGE:.1,CPU_USAGE:.1,LOAD_AVG:.1,task_list:{TASK_ID:"TASK_ID",PLUGIN_NAME:"BashPlugin"},heartbeat_time:1533274697.336775,LOGICAL_CPU_CORE_NUM:4,addr:["10.100.60.112",38920]}}}},created:function(){for(var e in this.getData(),this.cities)this.$set(this.checked,e,[]);this.getGroupList()},computed:{data:function(){}},filters:{formatDate:function(e){var t=new Date(p()(1e3*e));return Object(m.a)(t,"yyyy-MM-dd HH:mm:ss")},formatGroupName:function(e){var t="";for(var a in e)t+=e[a].group_name+",";return t},statusFilter:function(e){return{2:"success",0:"info",1:"danger",4:"danger"}[e]},statusNameFilter:function(e){return{1:"Token Ready",0:"未授权",2:"已授权",3:"在线",4:"离线"}[e]}},methods:{getDateDiff:function(e){return Object(m.b)(e)},getGroupList:function(){var e=this;this.$axios.get("/api/group/list",{params:{status:1}}).then(function(t){e.select_group=t.data.result,e.total_nodes||(e.total_nodes=t.data.result),e.nodes=t.data.result})},handleChange:function(){this.$emit("change",this.checked)},handleDetail:function(e){this.getData(),this.cur_node_detail=e,this.detailVisible=!0},handleCheckAllChange:function(e){this.isIndeterminate=!1},handleCheckedCitiesChange:function(e){var t=e.length;this.checkAll=t===this.nodes.length,this.isIndeterminate=t>0&&t<this.nodes.length},handbleAuth:function(e,t){var a=t;this.form.id=a.id,this.getGroupList(),this.authVisible=!0},trans_params:function(e){var t=new URLSearchParams,a=!0,i=!1,n=void 0;try{for(var o,c=d()(r()(e));!(a=(o=c.next()).done);a=!0){var u=o.value,_=h()(u,2),p=_[0],m=_[1];if("object"==(void 0===m?"undefined":l()(m))){var f=!0,g=!1,b=void 0;try{for(var v,k=d()(s()(m));!(f=(v=k.next()).done);f=!0){var y=v.value;t.append(p,y)}}catch(e){g=!0,b=e}finally{try{!f&&k.return&&k.return()}finally{if(g)throw b}}}else t.append(p,m)}}catch(e){i=!0,n=e}finally{try{!a&&c.return&&c.return()}finally{if(i)throw n}}return t},doAuth:function(){var e=this;this.form.group_id=this.checkedCities,""!=this.form.node_name?(this.form.op="enable",this.$axios.post(this.node_auth_url,this.trans_params(this.form)).then(function(t){1==t.data.status?(e.$message.success("节点授权成功"),e.getData()):e.$message.error("节点授权失败, 错误码:"+t.data.status+t.data.msg),e.authVisible=!1})):this.$message.error("节点名称不能为空")},doEdit:function(){var e=this;this.form.group_id=this.checkedCities,""!=this.form.node_name?(this.form.op="edit",this.$axios.post(this.node_auth_url,this.trans_params(this.form)).then(function(t){1==t.data.status?(e.$message.success("节点编辑成功"),e.getData()):e.$message.error("节点编辑失败, 错误码:"+t.data.status+t.data.msg),e.editVisible=!1})):this.$message.error("节点名称不能为空")},handleSizeChange:function(e){this.page_size=e,this.getData()},handleCurrentChange:function(e){this.cur_page=e,this.getData()},getData:function(){var e=this;this.$axios.get(this.list_url,{params:{page_index:this.cur_page,group_id:this.selected_group,search:this.select_word,node_status:this.select_status,page_size:this.page_size}}).then(function(t){e.tableData=t.data.result,e.total=t.data.count})},search:function(){this.getData()},handleEdit:function(e,t){if(3===t.node_status){this.form.id=t.id,this.form.node_name=t.node_name;var a=[];for(var i in this.getGroupList(),t.group)a.push(t.group[i].id);this.checkedCities=a,this.editVisible=!0}else this.$message.info("编辑前请授权")},deleteNode:function(){var e=this;this.$confirm("是否确认此操作","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(function(){e.$axios.post(e.node_del_url,e.del_list).then(function(t){1==t.data.status?(e.getData(),e.$message.success("删除成功")):e.$message.error("删除失败, 错误码:"+t.data.status)})}).catch(function(){e.$message({type:"info",message:"操作已取消"})})},diableNode:function(){var e=this;this.$confirm("是否确认此操作","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(function(){e.diableNode.append("op","disable"),e.$axios.post(e.node_disable_url,e.disable_list).then(function(t){1==t.data.status?(e.getData(),e.$message.success("删除成功")):e.$message.error("删除失败, 错误码:"+t.data.status)})}).catch(function(){e.$message({type:"info",message:"操作已取消"})})},handleSelectionChange:function(e){this.multipleSelection=e},nodeDel:function(e){this.del_list=new URLSearchParams,this.del_list.append("id",e),this.deleteNode(),this.getData()},batchDisable:function(){var e=this.multipleSelection.length;this.enable_list=new URLSearchParams;for(var t=0;t<e;t++)this.enable_list.append("id",this.multipleSelection[t].id);this.diableNode()},batchDel:function(){var e=this.multipleSelection.length;this.del_list=new URLSearchParams;for(var t=0;t<e;t++)this.del_list.append("id",this.multipleSelection[t].id);this.deleteNode(),this.getData()}}},g={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"table"},[a("div",{staticClass:"crumbs"},[a("el-breadcrumb",{attrs:{separator:"/"}},[a("el-breadcrumb-item",[a("i",{staticClass:"el-icon-tickets"}),e._v(" 节点")]),e._v(" "),a("el-breadcrumb-item",[e._v("节点管理")])],1)],1),e._v(" "),a("div",{staticClass:"container"},[a("div",{staticClass:"handle-box"},[a("el-select",{staticClass:"handle-select mr10",attrs:{size:"mini",placeholder:"筛选分组"},model:{value:e.selected_group,callback:function(t){e.selected_group=t},expression:"selected_group"}},[a("el-option",{key:"0",attrs:{label:"全部",value:""}}),e._v(" "),e._l(e.select_group,function(e){return a("el-option",{key:e.id,attrs:{label:e.group_name,value:e.id}})})],2),e._v(" "),a("el-select",{staticClass:"handle-select mr10",attrs:{size:"mini",placeholder:"筛选状态"},model:{value:e.select_status,callback:function(t){e.select_status=t},expression:"select_status"}},[a("el-option",{key:"1",attrs:{label:"在线",value:"1"}}),e._v(" "),a("el-option",{key:"2",attrs:{label:"离线",value:"-1"}}),e._v(" "),a("el-option",{key:"3",attrs:{label:"未授权",value:"0"}})],1),e._v(" "),a("el-input",{staticClass:"handle-input mr10",attrs:{size:"mini",placeholder:"筛选关键词"},nativeOn:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key,"Enter"))return null;e.search()}},model:{value:e.select_word,callback:function(t){e.select_word=t},expression:"select_word"}}),e._v(" "),a("el-button",{attrs:{type:"primary",icon:"search",size:"mini"},on:{click:e.search}},[e._v("搜索")])],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.tableData,border:""},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),a("el-table-column",{attrs:{prop:"node_name",label:"节点名称","min-width":"150"}}),e._v(" "),a("el-table-column",{attrs:{prop:"node_addr",label:"节点地址","min-width":"180"}}),e._v(" "),a("el-table-column",{attrs:{prop:"group",label:"节点分组",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                      "+e._s(e._f("formatGroupName")(t.row.group))+"\n                      ")]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"node_status",label:"状态",sortable:"",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:e._f("statusFilter")(t.row.node_status)}},[e._v(e._s(e._f("statusNameFilter")(t.row.node_status)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"task_count",label:"任务",sortable:"",width:"70"}}),e._v(" "),a("el-table-column",{attrs:{prop:"heartbeat_time",label:"最后心跳",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                      "+e._s(e.getDateDiff(t.row.time_diff))+"\n                      ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"150",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{directives:[{name:"tooltip",rawName:"v-tooltip",value:"查看节点详情",expression:"'查看节点详情'"}],attrs:{size:"mini"},on:{click:function(a){e.handleDetail(t.row)}}},[a("i",{staticClass:"el-icon-xiangqing1  iconfont_no_margin sumeru_op_button"})]),e._v(" "),a("span",{directives:[{name:"tooltip",rawName:"v-tooltip",value:"授权节点",expression:"'授权节点'"}],attrs:{size:"mini"},on:{click:function(a){e.handbleAuth(t.$index,t.row)}}},[a("i",{staticClass:"el-icon-shouquan2 iconfont_no_margin sumeru_op_button"})]),e._v(" "),a("span",{directives:[{name:"tooltip",rawName:"v-tooltip",value:"编辑节点配置",expression:"'编辑节点配置'"}],attrs:{size:"mini"},on:{click:function(a){e.handleEdit(t.$index,t.row)}}},[a("i",{staticClass:"el-icon-bianji2  iconfont_no_margin sumeru_op_button"})]),e._v(" "),a("span",{directives:[{name:"tooltip",rawName:"v-tooltip",value:"删除节点",expression:"'删除节点'"}],attrs:{size:"mini",type:"danger"},on:{click:function(a){e.nodeDel(t.row.id)}}},[a("i",{staticClass:"el-icon-shanchu1    iconfont_no_margin sumeru_op_button sumeru_red"})])]}}])})],1),e._v(" "),a("div",{staticClass:"pagination"},[a("el-button",{staticClass:"handle-del mr10 float_left_margin",attrs:{type:"danger",size:"mini",icon:"delete"},on:{click:e.batchDisable}},[e._v("批量禁用")]),e._v(" "),a("el-button",{staticClass:"handle-del mr10 float_left_margin",attrs:{type:"danger",size:"mini",icon:"delete"},on:{click:e.batchDel}},[e._v("批量删除")]),e._v(" "),a("el-pagination",{attrs:{"current-page":e.cur_page,"page-sizes":[10,20,50,100],"page-size":e.page_size,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.cur_page=t},"update:pageSize":function(t){e.page_size=t},"update:total":function(t){e.total=t}}})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"节点详情",visible:e.detailVisible,width:"50%"},on:{"update:visible":function(t){e.detailVisible=t}}},[a("el-form",{ref:"form",attrs:{"label-width":"50px"}},[a("el-form-item",{attrs:{label:"节点运行信息"}},[a("el-progress",{attrs:{type:"circle",percentage:e.cur_node_detail.sysinfo?e.cur_node_detail.sysinfo.RAM_USAGE:0}}),e._v("内存占用 \n                    "),a("el-progress",{attrs:{type:"circle",percentage:e.cur_node_detail.sysinfo?e.cur_node_detail.sysinfo.CPU_USAGE:0,color:"#2e71c7"}}),e._v("CPU使用率\n                    "),a("el-progress",{attrs:{type:"circle",percentage:e.cur_node_detail.sysinfo?e.cur_node_detail.sysinfo.DISK_USAGE:0,color:"#8e71c7"}}),e._v("磁盘使用率\n                ")],1),e._v(" "),a("el-form-item",{attrs:{label:"节点详细"}},[a("el-scrollbar",{staticClass:"h_scrollbar"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.cur_node_detail.sysinfo&&e.cur_node_detail.sysinfo.task_list?e.cur_node_detail.sysinfo.task_list:[],border:""}},[a("el-table-column",{attrs:{prop:"TASK_ID",label:"任务ID","max-width":"80","show-overflow-tooltip":!0}}),e._v(" "),a("el-table-column",{attrs:{prop:"PLUGIN_NAME","max-width":"100",label:"应用类型","show-overflow-tooltip":!0}})],1)],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"})],1),e._v(" "),a("el-dialog",{attrs:{title:"节点授权",visible:e.authVisible,width:"35%"},on:{"update:visible":function(t){e.authVisible=t}}},[a("el-form",{ref:"form",attrs:{model:e.form,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"节点名称"}},[a("el-input",{attrs:{clearable:""},model:{value:e.form.node_name,callback:function(t){e.$set(e.form,"node_name",t)},expression:"form.node_name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"节点分组"}},[a("el-checkbox-group",{on:{change:e.handleCheckedCitiesChange},model:{value:e.checkedCities,callback:function(t){e.checkedCities=t},expression:"checkedCities"}},e._l(e.nodes,function(t){return a("el-checkbox",{key:t.id,attrs:{label:t.id}},[e._v(e._s(t.group_name))])}))],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:e.doAuth}},[e._v("确 定")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"节点编辑",visible:e.editVisible,width:"30%"},on:{"update:visible":function(t){e.editVisible=t}}},[a("el-form",{ref:"form",attrs:{model:e.form,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"节点名称"}},[a("el-input",{attrs:{clearable:""},model:{value:e.form.node_name,callback:function(t){e.$set(e.form,"node_name",t)},expression:"form.node_name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"节点分组"}},[a("el-checkbox-group",{on:{change:e.handleCheckedCitiesChange},model:{value:e.checkedCities,callback:function(t){e.checkedCities=t},expression:"checkedCities"}},e._l(e.nodes,function(t){return a("el-checkbox",{key:t.id,attrs:{label:t.id}},[e._v(e._s(t.group_name))])}))],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:e.doEdit}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var b=a("VU/8")(f,g,!1,function(e){a("ymKu")},"data-v-88e7255e",null);t.default=b.exports},ymKu:function(e,t){}});