webpackJsonp([9],{"+OPL":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("gRE1"),s=a.n(i),n=a("pFYg"),l=a.n(n),o=a("W3Iv"),r=a.n(o),u=a("BO1k"),c=a.n(u),d=a("d7EF"),p=a.n(d),_=a("E5Az");a("jGSh"),a("mw3O");a("tWbI");var m=a("xrTZ").Base64,f={components:{codemirror:_.codemirror},name:"task",data:function(){return{list_url:"/api/group/list",node_group_del_url:"api/group/del",node_group_add_url:"api/group/add",node_group_edit_url:"api/group/modify",tableData:[],cur_page:1,cur_page_size:10,multipleSelection:[],checkedAvailablePlugin:[],raw_plugin_list:[],cur_node_status:"1",select_word:"",select_node_group:"启用",del_list:new URLSearchParams,loading:!0,editVisible:!1,total:0,newNodeGroupVisible:!1,form:{plugins:[],group_name:"",status:1,id:""}}},filters:{statusFilter:function(t){return{1:"success",2:"info",0:"danger"}[t]},statusNameFilter:function(t){return{1:"启用",0:"禁用"}[t]}},created:function(){this.getData()},computed:{data:function(){}},methods:{trans_params:function(t){var e=new URLSearchParams,a=!0,i=!1,n=void 0;try{for(var o,u=c()(r()(t));!(a=(o=u.next()).done);a=!0){var d=o.value,_=p()(d,2),m=_[0],f=_[1];if("object"==(void 0===f?"undefined":l()(f))){var h=!0,g=!1,v=void 0;try{for(var b,w=c()(s()(f));!(h=(b=w.next()).done);h=!0){var y=b.value;e.append(m,y)}}catch(t){g=!0,v=t}finally{try{!h&&w.return&&w.return()}finally{if(g)throw v}}}else e.append(m,f)}}catch(t){i=!0,n=t}finally{try{!a&&u.return&&u.return()}finally{if(i)throw n}}return e},getPluginList:function(){var t=this;this.$axios.get("/api/plugin/list",{params:{status:1}}).then(function(e){console.log(e.data.result),t.raw_plugin_list=e.data.result})},handleSizeChange:function(t){this.cur_page_size=t,this.getData()},handleCurrentChange:function(t){this.cur_page=t,this.getData()},getData:function(){var t=this;this.$axios.get(this.list_url,{params:{page_index:this.cur_page,page_size:this.cur_page_size,status:this.cur_node_status,search:this.select_word}}).then(function(e){console.log(e),t.tableData=e.data.result,t.total=e.data.count})},search:function(){this.is_search=!0,this.getData()},formatter:function(t,e){return m.decode(t.task_code)},filterTag:function(t,e){return e.tag===t},newNodeGroup:function(){this.newNodeGroupVisible=!0},saveNewNodeGroup:function(){var t=this;this.newNodeGroupVisible=!1,this.$axios.post(this.node_group_add_url,this.trans_params(this.form)).then(function(e){1==e.data.status?(t.$message.success("节点分组创建成功"),t.getData()):t.$message.error("节点创建失败, 错误码:"+e.data.status+e.data.msg)})},handleEdit:function(t,e){this.getPluginList(),this.form={plugins:e.plugins.split(","),group_name:e.group_name,status:e.status.toString(),id:e.id},console.log(this.form),this.editVisible=!0},handleDelete:function(t){this.del_list=new URLSearchParams,this.del_list.append("id",t),this.deleteNode()},del_node_list:function(){var t=this.multipleSelection.length;this.del_list=new URLSearchParams;for(var e=0;e<t;e++)this.del_list.append("id",this.multipleSelection[e].id);this.deleteNode(),this.multipleSelection=[]},handleSelectionChange:function(t){this.multipleSelection=t},saveEdit:function(){var t=this;this.$set(this.tableData,this.idx,this.form),console.log(this.form),this.$axios.post(this.node_group_edit_url,this.trans_params(this.form)).then(function(e){1==e.data.status?(t.$message.success("节点分组修改成功"),t.getData()):t.$message.error("节点分组修改失败, 错误码:"+e.data.status+e.data.msg)}),this.editVisible=!1},deleteNode:function(){var t=this;this.$confirm("是否确认此操作","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(function(){t.$axios.post(t.node_group_del_url,t.del_list).then(function(e){1==e.data.status?(t.getData(),t.$message.success("删除成功")):t.$message.error("删除失败, 错误码:"+e.data.status)})}).catch(function(){t.$message({type:"info",message:"操作已取消"})})}}},h={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"table"},[a("div",{staticClass:"crumbs"},[a("el-breadcrumb",{attrs:{separator:"/"}},[a("el-breadcrumb-item",[a("i",{staticClass:"el-icon-tickets"}),t._v(" 节点")]),t._v(" "),a("el-breadcrumb-item",[t._v("节点分组")])],1)],1),t._v(" "),a("div",{staticClass:"container"},[a("div",{staticClass:"handle-box"},[a("el-button",{staticClass:" mr10",attrs:{size:"mini",type:"primary",icon:"primary"},on:{click:t.newNodeGroup}},[t._v("新建分组")]),t._v(" "),a("el-select",{staticClass:"handle-select mr10",attrs:{size:"mini"},model:{value:t.cur_node_status,callback:function(e){t.cur_node_status=e},expression:"cur_node_status"}},[a("el-option",{key:"1",attrs:{label:"启用",value:"1"}}),t._v(" "),a("el-option",{key:"0",attrs:{label:"禁用",value:"0"}}),t._v(" "),a("el-option",{key:"2",attrs:{label:"全选",value:""}})],1),t._v(" "),a("el-input",{staticClass:"handle-input mr10",attrs:{size:"mini",placeholder:"筛选关键词"},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;t.search()}},model:{value:t.select_word,callback:function(e){t.select_word=e},expression:"select_word"}}),t._v(" "),a("el-button",{attrs:{size:"mini",type:"primary",icon:"search"},on:{click:t.search}},[t._v("搜索")])],1),t._v(" "),a("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:t.tableData,border:""},on:{"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),t._v(" "),a("el-table-column",{attrs:{prop:"id",label:"ID",width:"230","show-overflow-tooltip":!0}}),t._v(" "),a("el-table-column",{attrs:{prop:"group_name",label:"分组名称"}}),t._v(" "),a("el-table-column",{attrs:{prop:"node_count",label:"节点总数"}}),t._v(" "),a("el-table-column",{attrs:{prop:"status",label:"分组状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tag",{attrs:{type:t._f("statusFilter")(e.row.status)}},[t._v(t._s(t._f("statusNameFilter")(e.row.status)))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{directives:[{name:"tooltip",rawName:"v-tooltip",value:"编辑节点分组",expression:"'编辑节点分组'"}],attrs:{size:"mini"},on:{click:function(a){t.handleEdit(e.$index,e.row)}}},[a("i",{staticClass:"el-icon-bianji2  iconfont_no_margin sumeru_op_button"})]),t._v(" "),a("span",{directives:[{name:"tooltip",rawName:"v-tooltip",value:"删除节点分组",expression:"'删除节点分组'"}],attrs:{size:"mini",type:"danger"},on:{click:function(a){t.handleDelete(e.row.id)}}},[a("i",{staticClass:"el-icon-shanchu1    iconfont_no_margin sumeru_op_button sumeru_red"})])]}}])})],1),t._v(" "),a("div",{staticClass:"pagination"},[a("el-button",{staticClass:"handle-del mr10 float_left_margin",attrs:{size:"mini",type:"danger",icon:"delete"},on:{click:t.del_node_list}},[t._v("批量删除")]),t._v(" "),a("el-pagination",{attrs:{"current-page":t.cur_page,"page-sizes":[10,20,50,100],"page-size":10,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange,"update:currentPage":function(e){t.cur_page=e},"update:total":function(e){t.total=e}}})],1)],1),t._v(" "),a("el-dialog",{attrs:{title:"新建分组",visible:t.newNodeGroupVisible,width:"20%"},on:{"update:visible":function(e){t.newNodeGroupVisible=e}}},[a("el-form",{ref:"form",attrs:{model:t.form,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"分组名称:"}},[a("el-input",{attrs:{clearable:""},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;t.saveNewNodeGroup()}},model:{value:t.form.group_name,callback:function(e){t.$set(t.form,"group_name",e)},expression:"form.group_name"}})],1)],1),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.newNodeGroupVisible=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.saveNewNodeGroup()}}},[t._v("确定")])],1)],1),t._v(" "),a("el-dialog",{attrs:{title:"编辑",visible:t.editVisible,width:"35%"},on:{"update:visible":function(e){t.editVisible=e}}},[a("el-form",{ref:"form",attrs:{model:t.form,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"分组名称:"}},[a("el-input",{attrs:{clearable:""},model:{value:t.form.group_name,callback:function(e){t.$set(t.form,"group_name",e)},expression:"form.group_name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"节点状态:"}},[a("el-select",{staticClass:"handle-select mr10",attrs:{placeholder:"状态"},model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}},[a("el-option",{attrs:{label:"启用",value:"1"}}),t._v(" "),a("el-option",{attrs:{label:"禁用",value:"0"}})],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"可用应用"}},[a("el-checkbox-group",{model:{value:t.form.plugins,callback:function(e){t.$set(t.form,"plugins",e)},expression:"form.plugins"}},t._l(t.raw_plugin_list,function(e){return a("el-checkbox",{key:e.plugin_name,attrs:{label:e.plugin_name,value:e.plugin_name}},[t._v(t._s(e.plugin_name))])}))],1)],1),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.editVisible=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.saveEdit}},[t._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var g=a("VU/8")(f,h,!1,function(t){a("d0LJ")},"data-v-2cd3786f",null);e.default=g.exports},d0LJ:function(t,e){}});