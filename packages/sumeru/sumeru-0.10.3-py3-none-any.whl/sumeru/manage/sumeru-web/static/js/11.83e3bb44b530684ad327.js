webpackJsonp([11],{"9MVw":function(e,t){},rcre:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("gRE1"),s=a.n(i),n=a("pFYg"),l=a.n(n),r=a("W3Iv"),o=a.n(r),c=a("BO1k"),d=a.n(c),u=a("d7EF"),h=a.n(u),p=a("fZjL"),m=a.n(p),_=a("INCx"),g=a.n(_),f=(a("mw3O"),a("X2Oc")),b={name:"node",data:function(){return{cols:[],checked:{},authNode:"",node_auth_url:"/api/dnode/modify",list_url:"/api/plugin/data",node_del_url:"/api/dnode/del",del_list:new URLSearchParams,disable_list:[],checkAll:!1,checkedCities:[],total_nodes:[],nodes:[],isIndeterminate:!0,tableData:[],select_table_list:[],select_table:"",selected_table:null,select_status:"",select_word:"",cur_page:1,time_data:null,page_size:10,total:0,loading:null,multipleSelection:[],is_search:!1,detailVisible:!1,authVisible:!1,editVisible:!1,delVisible:!1,query_form:{},form:{node_name:"",id:"",group_id:[]},cur_node_detail:{sysinfo:{RAM_USAGE:.1,CPU_USAGE:.1,LOAD_AVG:.1,task_list:{TASK_ID:"TASK_ID",PLUGIN_NAME:"BashPlugin"},heartbeat_time:1533274697.336775,LOGICAL_CPU_CORE_NUM:4,addr:["10.100.60.112",38920]}},pickerOptions2:{shortcuts:[{text:"最近一周",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-6048e5),e.$emit("pick",[a,t])}},{text:"最近一个月",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-2592e6),e.$emit("pick",[a,t])}},{text:"最近三个月",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-7776e6),e.$emit("pick",[a,t])}}]}}},created:function(){for(var e in this.loadTableList(),this.cities)this.$set(this.checked,e,[]);this.getGroupList()},computed:{data:function(){}},filters:{formatDate:function(e){var t=new Date(g()(1e3*e));return Object(f.a)(t,"yyyy-MM-dd HH:mm:ss")},formatGroupName:function(e){var t="";for(var a in e)t+=e[a].group_name+",";return t},statusFilter:function(e){return{2:"success",0:"info",1:"danger",4:"danger"}[e]},statusNameFilter:function(e){return{1:"Token Ready",0:"未授权",2:"已授权",3:"在线",4:"离线"}[e]}},methods:{get_select_table:function(){var e=this;this.cols=this.table_list[this.selected_table],this.$axios.get("/api/plugin/tables",{params:{plugin_name:this.selected_table}}).then(function(t){e.getData()})},loadTableList:function(){var e=this;this.$axios.get("/api/plugin/tables").then(function(t){e.table_list=t.data.result,e.select_table_list=m()(e.table_list)})},renderTimePicker:function(e,t){t.column;return this.$emit("value",this.time_data),e("span",[e("el-date-picker",{domProps:{value:self.value},attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},on:{change:this.change}})])},renderInput:function(e,t){var a=t.column;return self.$emit("value","time_data"),e("span",[e("el-input",{attrs:{placeholder:a.label},on:{change:this.change}})])},change:function(e){this.query_form.node_name=e,this.time=e},headerRender:function(e,t){return e("div",{attrs:{class:"cell-box"}},[t.column.label+"===",e("span")])},getGroupList:function(){var e=this;this.$axios.get("/api/group/list",{params:{status:1}}).then(function(t){e.select_group=t.data.result,e.total_nodes||(e.total_nodes=t.data.result),e.nodes=t.data.result})},handleChange:function(){this.$emit("change",this.checked)},handleDetail:function(e){this.getData(),this.cur_node_detail=e,this.detailVisible=!0},handbleAuth:function(e,t){var a=t;this.form.id=a.id,this.getGroupList(),this.authVisible=!0},trans_params:function(e){var t=new URLSearchParams,a=!0,i=!1,n=void 0;try{for(var r,c=d()(o()(e));!(a=(r=c.next()).done);a=!0){var u=r.value,p=h()(u,2),m=p[0],_=p[1];if("object"==(void 0===_?"undefined":l()(_))){var g=!0,f=!1,b=void 0;try{for(var v,k=d()(s()(_));!(g=(v=k.next()).done);g=!0){var y=v.value;t.append(m,y)}}catch(e){f=!0,b=e}finally{try{!g&&k.return&&k.return()}finally{if(f)throw b}}}else t.append(m,_)}}catch(e){i=!0,n=e}finally{try{!a&&c.return&&c.return()}finally{if(i)throw n}}return t},doAuth:function(){var e=this;this.form.group_id=this.checkedCities,""!=this.form.node_name?(this.form.op="enable",this.$axios.post(this.node_auth_url,this.trans_params(this.form)).then(function(t){1==t.data.status?(e.$message.success("节点授权成功"),e.getData()):e.$message.error("节点授权失败, 错误码:"+t.data.status+t.data.msg),e.authVisible=!1})):this.$message.error("节点名称不能为空")},doEdit:function(){var e=this;this.form.group_id=this.checkedCities,""!=this.form.node_name?(this.form.op="edit",this.$axios.post(this.node_auth_url,this.trans_params(this.form)).then(function(t){1==t.data.status?(e.$message.success("节点编辑成功"),e.getData()):e.$message.error("节点编辑失败, 错误码:"+t.data.status+t.data.msg),e.editVisible=!1})):this.$message.error("节点名称不能为空")},handleSizeChange:function(e){this.page_size=e,this.getData()},handleCurrentChange:function(e){this.cur_page=e,this.getData()},getData:function(){var e=this;this.$axios.get(this.list_url,{params:{plugin_name:this.selected_table,start:this.time_data?this.time_data[0]/1e3:null,end:this.time_data?this.time_data[1]/1e3:null,page_index:this.cur_page,group_id:this.selected_group,search:this.select_word,node_status:null,page_size:this.page_size}}).then(function(t){e.tableData=t.data.result,e.total=t.data.count})},search:function(){this.getData()},handleEdit:function(e,t){this.form.id=t.id,this.form.node_name=t.node_name;var a=[];for(var i in this.getGroupList(),t.group)a.push(t.group[i].id);this.checkedCities=a,this.editVisible=!0},deleteNode:function(){var e=this;this.$confirm("是否确认此操作","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(function(){e.$axios.post(e.node_del_url,e.del_list).then(function(t){1==t.data.status?(e.getData(),e.$message.success("删除成功")):e.$message.error("删除失败, 错误码:"+t.data.status)})}).catch(function(){e.$message({type:"info",message:"操作已取消"})})},diableNode:function(){var e=this;this.$confirm("是否确认此操作","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(function(){e.diableNode.append("op","disable"),e.$axios.post(e.node_disable_url,e.disable_list).then(function(t){1==t.data.status?(e.getData(),e.$message.success("删除成功")):e.$message.error("删除失败, 错误码:"+t.data.status)})}).catch(function(){e.$message({type:"info",message:"操作已取消"})})},handleSelectionChange:function(e){this.multipleSelection=e},batchDisable:function(){var e=this.multipleSelection.length;this.enable_list=new URLSearchParams;for(var t=0;t<e;t++)this.enable_list.append("id",this.multipleSelection[t].id);this.diableNode()},batchDel:function(){var e=this.multipleSelection.length;this.del_list=new URLSearchParams;for(var t=0;t<e;t++)this.del_list.append("id",this.multipleSelection[t].id);this.deleteNode(),this.getData()}}},v={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"table"},[a("div",{staticClass:"crumbs"},[a("el-breadcrumb",{attrs:{separator:"/"}},[a("el-breadcrumb-item",[a("i",{staticClass:"el-icon-tickets"}),e._v(" 任务结果")])],1)],1),e._v(" "),a("div",{staticClass:"container"},[a("div",{staticClass:"handle-box"},[a("el-select",{staticClass:"handle-select mr10",attrs:{size:"mini",placeholder:"数据表"},on:{change:e.get_select_table},model:{value:e.selected_table,callback:function(t){e.selected_table=t},expression:"selected_table"}},e._l(e.select_table_list,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),e._v(" "),a("el-input",{staticClass:"handle-input mr10",attrs:{size:"mini",placeholder:"筛选关键词"},nativeOn:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key,"Enter"))return null;e.search()}},model:{value:e.select_word,callback:function(t){e.select_word=t},expression:"select_word"}}),e._v(" "),a("el-button",{attrs:{type:"primary",icon:"search",size:"mini"},on:{click:e.search}},[e._v("查询")]),e._v(" "),a("el-date-picker",{attrs:{type:"datetimerange","picker-options":e.pickerOptions2,"range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",align:"right","value-format":"timestamp",size:"mini"},model:{value:e.time_data,callback:function(t){e.time_data=t},expression:"time_data"}})],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.tableData,border:""},on:{"selection-change":e.handleSelectionChange}},[e._l(e.cols,function(e,t){return[a("el-table-column",{attrs:{prop:e.name,label:e.name,sortable:"","show-overflow-tooltip":!0,"v-model":e.id}})]})],2),e._v(" "),a("div",{staticClass:"pagination"},[a("el-pagination",{attrs:{"current-page":e.cur_page,"page-sizes":[10,20,50,100],"page-size":e.page_size,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.cur_page=t},"update:pageSize":function(t){e.page_size=t},"update:total":function(t){e.total=t}}})],1)],1)])},staticRenderFns:[]};var k=a("VU/8")(b,v,!1,function(e){a("9MVw")},"data-v-265e9183",null);t.default=k.exports}});