<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Page Title</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type="text/css">
        {{ include_file('css/semantic.min.css', asset_dir) }}
        {{ include_file('css/dataTables.semanticui.min.css', asset_dir) }}
    </style>
    <style type="text/css">
        td.details-control {
            background: url(data:image/png;base64,{{ include_file('images/details_open.png', asset_dir, b64=True) }}) no-repeat center center;
            cursor: pointer;
            width: 50px;
        }   
        tr.shown td.details-control {
            background: url(data:image/png;base64,{{ include_file('images/details_close.png', asset_dir, b64=True) }}) no-repeat center center;
        }

        .result_pass {
            background-color: #27AE60 ;
            color: #ffffff;
            font-weight: 700;
        }
        .result_warning {
            background-color: #E67E22;
            color: #ffffff;
            font-weight: 700;
        }
        .result_failure {
            background-color: #E74C3C ;
            color: #ffffff;
            font-weight: 700;
        }
        tr.odd {
            background-color: #FBFCFC;
        }
        .ui.table thead th {
            background-color: #D0D3D4;
            font-size: 16px;
            font-weight: 700;
        }
    </style>

    <style type="text/css">
        @font-face{
            font-family:Icons;
            src:url(data:font/eot;base64,{{ include_file('fonts/icons.eot', asset_dir, b64=True) }});
            src:url(data:font/eot;base64,{{ include_file('fonts/icons.eot', asset_dir, b64=True) }}) format('embedded-opentype'),
                url(data:x-font-woff/woff2;base64,{{ include_file('fonts/icons.woff2', asset_dir, b64=True) }}) format('woff2'),
                url(data:x-font-woff/woff;base64,{{ include_file('fonts/icons.woff', asset_dir, b64=True) }}) format('woff'),
                url(data:font/ttf;base64,{{ include_file('fonts/icons.ttf', asset_dir, b64=True) }}) format('truetype'),
                url(data:font/svg;base64,{{ include_file('fonts/icons.svg', asset_dir, b64=True) }}) format('svg');
            font-style:normal;
            font-weight:400;
            font-variant:normal;
            text-decoration:inherit;
            text-transform:none;
        }
    </style>


    <script type="text/javascript">{{ include_file('js/jquery-3.3.1.min.js', asset_dir) }}</script>
    <script type="text/javascript">{{ include_file('js/jquery.dataTables.min.js', asset_dir) }}</script>
    <script type="text/javascript">{{ include_file('js/dataTables.semanticui.min.js', asset_dir) }}</script>
    <script type="text/javascript">{{ include_file('js/semantic.transition.min.js', asset_dir) }}</script>
    <script type="text/javascript">{{ include_file('js/semantic.dropdown.min.js', asset_dir) }}</script>
    <script>
        var data = {{ json_data }};
        /* function to check if all entries in object are empty */
        function check_all_empty(obj) {
            for (var key in obj) {
                if (obj[key].length > 0)
                    return false;
            }
            return true;
        }

        /* function to add extra table to datatable */
        function add_extra_row_data ( row_data ) {
            // `row_data` is the original data object for the row
            var table_string = '<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;">'
            
            if (! check_all_empty(row_data.checks)){
                table_string = table_string + 
                    '<tr>'+
                        '<th>File Type</th>' +
                        '<th>Metric</th>' +
                        '<th>Value</th>' +
                        '<th>Check</th>' +
                        '<th>Check Result</th>' +
                    '</tr>'

                for (check in row_data.checks){
                    for (index in row_data.checks[check]) {
                        table_string = table_string +
                        '<tr>'+
                            '<td>' + check + '</td>' +
                            '<td>' + row_data.checks[check][index].metric_name + '</td>' +
                            '<td>' + row_data.checks[check][index].metric_value + '</td>' +
                            '<td>' + row_data.checks[check][index].check + '</td>' +
                            '<td>' + row_data.checks[check][index].check_result + '</td>' +
                        '</tr>'
                    }
                }
            }
            table_string = table_string + '</table>';
            return(table_string)
        }
        $(document).ready( function () {
            var table = $('#myTable').DataTable({
                data: data,
                columns: [
                    {
                        "className":      'details-control',
                        "orderable":      false,
                        "data":           null,
                        "defaultContent": ''
                    },
                    { title: "Sample Name", data: "sample_name"},
                    { title: "Result", data: "result" },
                ],
                order: [[2, 'asc']],
                rowCallback: function(row, data, index){
                    if (data.result == 'PASS'){
                        $(row).find('td:eq(2)').addClass('result_pass');
                    } else if (data.result == 'WARNING'){
                        $(row).find('td:eq(2)').addClass('result_warning');
                    } else if (data.result == 'FAILURE'){
                        $(row).find('td:eq(2)').addClass('result_failure');
                    }
                }
            });
            // Add event listener for opening and closing details
            $('#myTable tbody').on('click', 'td.details-control', function () {
                var tr = $(this).closest('tr');
                var row = table.row( tr );
        
                if ( row.child.isShown() ) {
                    // This row is already open - close it
                    row.child.hide();
                    tr.removeClass('shown');
                }
                else {
                    // Open this row
                    row.child( add_extra_row_data(row.data()) ).show();
                    tr.addClass('shown');
                }
            } );
        } );
    </script>
</head>
<body>
<div class="ui container">
    <h1>{{ h1 }}</h1>
    <table id="myTable" class="ui celled table" style="width:100%">
    </table>
</div>
</body>
</html>